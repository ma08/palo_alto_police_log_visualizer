# Police Report Map Visualization (Next.js Frontend)

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

This directory contains the Next.js application for visualizing the processed Palo Alto police report data on an interactive map.

## Deployment

This specific frontend instance may be deployed on Vercel (check main project details). Deployment can be handled automatically via Vercel GitHub integration.

# Original Deployment URL: [https://palo-alto-police-log-visualizer.vercel.app/](https://palo-alto-police-log-visualizer.vercel.app/)

## Purpose

-   Display geocoded police incidents from [website/public/data/incidents.json](website/public/data/incidents.json) on an interactive Google Map. *Currently, this includes data extracted from official logs dated February 18, 2025, to April 18, 2025.*
-   Allow users to click on incident markers to view details (case number, offense type, date, time, address) in an info window.
-   Provide an accessible web interface for the analysis results generated by the main project pipeline.

## Submodule Status

This directory is managed as a separate Git repository and included in the main [palo_alto_police_log_analysis](https://github.com/ma08/palo_alto_police_log_analysis) project as a Git submodule.
Ensure submodule commands (`git submodule update --init --recursive`) are used when cloning the parent repository if applicable.

## Tech Stack

-   [Next.js](https://nextjs.org/) (React Framework)
-   [React](https://reactjs.org/)
-   [TypeScript](https://www.typescriptlang.org/)
-   [Google Maps Platform](https://developers.google.com/maps) (using [@vis.gl/react-google-maps](https://visgl.github.io/react-google-maps/))
-   [Tailwind CSS](https://tailwindcss.com/) (Utility-first CSS framework)
-   [Vercel](https://vercel.com/) (Deployment Platform)

## Setup

1.  **Navigate to this directory:**
    ```bash
    cd website
    ```
2.  **Install Dependencies:**
    ```bash
    npm install
    # or
    # yarn install
    ```

3.  **Configure Google Maps API Key:**
    -   You will need a Google Maps Platform API key enabled for the **Maps JavaScript API**.
    -   Create a `.env.local` file in this `website` directory (copy from `.env.local.example` if provided).
    -   Add your API key to the file:
        ```
        NEXT_PUBLIC_GOOGLE_MAPS_API_KEY="YOUR_FRONTEND_MAPS_API_KEY"
        ```
    -   **Security:** This key is exposed in the frontend code. It is **critical** that you:
        -   Use a **different** API key than the one used for the backend geocoding script (`.env` in the parent directory).
        -   **Restrict** this frontend key in the Google Cloud Console using **HTTP referrers**, allowing only requests from your website's domain(s) (e.g., `yourdomain.com/*`, `*.yourdomain.com/*`, and `localhost:3000/*` for development).

4.  **Ensure Data Exists:**
    -   This application requires the data file `/public/data/incidents.json`.
    -   This file must be generated by running the main project pipeline (at least up to Step 5) in the parent directory *before* attempting to run or build this frontend application.
        ```bash
        # Example from parent directory:
        python run_pipeline.py --start-date YYYY-MM-DD --end-date YYYY-MM-DD
        ```

5.  **Run Development Server:**
    ```bash
    npm run dev
    # or
    # yarn dev
    ```
    Open [http://localhost:3000](http://localhost:3000) in your browser.

6.  **Build for Production:**
    ```bash
    npm run build
    ```

## Data (`/public/data/incidents.json`)

-   The application loads the incident data statically from this JSON file at build time.
-   This file is the final output of the main project's data processing pipeline (`pipeline/steps/step_5_prepare_output.py`).
-   **Data Structure:** The JSON is an array of incident objects. Key fields currently include:
    -   `case_number`: Incident identifier (string).
    -   `date`: Date of the incident (string, typically MM/DD/YYYY).
    -   `time`: Time of the incident represented as **minutes past midnight** (number, 0-1439). Invalid/missing times are represented as `0`.
    -   `offense_type`: Original offense description from the report (string).
    -   `offense_category`: Standardized offense category assigned by LLM (string).
    -   `location`: Original location string from the report (string).
    -   `latitude`, `longitude`: Geographic coordinates (number).
    -   `formatted_address`: Address returned by geocoding API (string).
    -   `google_maps_uri`: Link to Google Maps for the location (string).
    -   `place_types`: Comma-separated place types from geocoding (string).
    -   `location_interpretation`: Simplified interpretation of place type (string).
    -   `police_record_date_str`, `police_record_date`: Date associated with the source PDF report (string).



## Current Status & Functionality

-  Map successfully displays incident locations loaded from `/public/data/incidents.json`.
-  Markers are rendered using `@vis.gl/react-google-maps`.
-  Clicking a marker opens an `InfoWindow` showing key details.
-  Data types in the JSON (`time`, `case_number`) should now correctly match the frontend TypeScript types.
-  Requires a valid `NEXT_PUBLIC_GOOGLE_MAPS_API_KEY` in `.env.local` with appropriate restrictions.
-  Time and Category based filtering is available.
## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE).
